# Итоговый проект

## Тема: автоматическая настройка и восстановления веб-сервера 
____
- Количество серверов: 3 шт.

- Используемая ОС: CentOS 8

- Используемая сеть: 192.168.0.0/24

- Master сервер: 19.168.0.21/24

- Slave сервер: 192.168.0.17/24

- Сервер-замена : 192.168.0.22/24
____

Устанавливаем и настраиваем GIT:

    yum -y install git
Скачиваем репозиторий, например в /tmp:

    git clone https://github.com/beloglyadov/project
____
> Каталог **project**
> >
> > > elk-filebeat #Подкаталоги: стек Elasticsearch/Logstash/Kibana для Docker Compose 
> >  
> > > master #Каталог со скриптами настройки *master*, сервера замены и скриптом настройки мониторинга
> > 
> > > prom-grafana #Каталог с файлами настройки Prometheus 
> > 
> > > site #Подкаталог joomla с уже установленным сайтом и бэкапом БД: exam_db.sql
> > 
> > > slave #Каталог со скриптами настройки *slave* сервера и проверки состояния веб-сервера 
> >

# Цель проекта
Главная цель - продемонстрировать автоматическую настройку на *master* сервере рабочего сайта, его мониторинга и логирования, а также рпеликацию БД на *slave* сервере, на котором в свою очередь будет производиться раз в минуту проверка состояния веб-сервера на *master*, в случае если веб-сервер недоступен или возвращает ошибку, *master* будет выключен и запущено автоматическое восстановление на *master-new* до полностью рабочего состояния и настройки репликации БД со *slave* сервером.  

## Порядок установки 
Установка всех серверов производится в автоматическом режиме. Выполнение всех шагов установки начинается с *master* сервера.
В самом скрипте *master.sh* будет запущена установка и *slave* сервера 

### Установка на "Главном-сервере":
Выполняем подгтовку к запуску скрипта master.sh. Для этого необходимо перейти в каталог 

    cd /tmp/project/master/
дать права на выполнение скрипта **master.sh** и запустить его на выполнение.
    
    chmod +x ./master.sh && ./master.sh
После чего будет установлен и настроен *master* сервер:
    - установлена БД MySQL и веб-сервер httpd
    - восстановлен из бэкапа сайт на CMS Joomla
    - дополнительный софт для нормальной работы сайта 
Далее идёт установка *sshpass*, чтобы без ввода пароля на *slave* можно было скопировать скрипт установки и настройки, а затем запустить его выполнение.

сервере запустить выполнение скрипта настройки  восстановления сайта начинается вы
    
    , а также сервер *slave*, на котором будет установлена репликация БД с главным сервером.

На *slave* ещё будет запущено выполнение скрипта проверки состояния веб-сервера на 



    ./0-selinux-off.sh
Перезагружаемся,

Из подкаталога 1-server-slave запускаем скрипт

    ./1-new-sql-server-slave.sh
Установка проходит в полуавтоматическом режиме по нумерации скриптов из каталога,

Во время установки потребуется настроить компонент проверки пароля MySQL,

Установите пароль: User1589$

Установка на Основном сервере:
Заходим в подкаталог 2-server-master, отключаем SELinux

    ./0-selinux-off.sh
Перезагружаемся,

Из подкаталога 2-server-master запускаем скрипт

    ./1-new-sql-server-master.sh
Установка будет проходить в полуавтоматическом режиме по нумерации скриптов из каталога,

Во время установки потребуется настроить компонент проверки пароля MySQL,

Установите пароль: User1589$

На "Сервер-реплика"
В файле albo/3-sql/replication-slave.sql

Указываем binlog и MASTER_LOG_POS "Основного сервера"

На "Сервер-реплика" импортируем конфигурацию

    mysql -u root --password=User1589$ < /tmp/albo/3-sql/replication-slave.sql
На "Основном сервере"
Создать БД для CMS WordPress

    mysql -u root --password=User1589$ < /tmp/albo/3-sql/wp-db-user.sql
Создать таблицу в БД от имени пользователя wpuser

    mysql -u wpuser --password=WP1password$ < /tmp/albo/3-sql/wp-albo.sql
Сервер-реплика: готов
Основной сервер: готов
Домашняя страница Kibana http://10.0.0.2:5601 http://185.177.95.17:5601/

Пользователь: elastic

Пароль: changeme
